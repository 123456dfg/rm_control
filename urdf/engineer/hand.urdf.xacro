<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="hand">
    <!-- safety_distance: Minimum safety distance in [m] by which the collision volumes are expanded and which is enforced during robot motions -->
    <xacro:macro name="hand" params="connected_to:='' xyz:='0 0 0' rpy:='0 0 0' simulation ">

        <material name="Black">
            <color rgba="0 0 0 1"/>
        </material>

        <material name="White">
            <color rgba="1 1 1 1"/>
        </material>

        <link name="palm">
            <inertial>
                <mass value="0.695"/>
                <origin xyz="0.0 0.0 0.024" rpy="0 0 0"/>
                <inertia ixx="5.042e-4" ixy="1.20e-7" ixz="-3.142e-6" iyy="2.444e-4" iyz="1.18e-7" izz="4.945e-4"/>
            </inertial>
            <visual>
                <geometry>
                    <mesh filename="package://rm_description/meshes/engineer/palm.stl" scale="0.001 0.001 0.001"/>
                </geometry>
            </visual>
            <collision>
                <origin xyz="0 0 0.027" rpy="0 0 0"/>
                <geometry>
                    <box size="0.055 0.267 0.06"/>
                </geometry>
            </collision>
        </link>

        <link name="right_finger">
            <inertial>
                <origin xyz="0.0 0.075 0.021" rpy="0 0 0"/>
                <mass value="0.284"/>
                <inertia ixx="7.653e-4" ixy="1.922e-5" ixz="1.589e-5" iyy="3.805e-4" iyz="-3.052e-4" izz="4.364e-4"/>
            </inertial>
            <visual>
                <geometry>
                    <mesh filename="package://rm_description/meshes/engineer/right_finger.stl"
                          scale="0.001 0.001 0.001"/>
                </geometry>
            </visual>
            <collision>
                <origin xyz="0.0 0.046 0.005" rpy="0 0 0"/>
                <geometry>
                    <box size="0.030 0.027 0.063"/>
                </geometry>
            </collision>
            <collision>
                <origin xyz="0.0 0.091 0.025" rpy="0 0 0"/>
                <geometry>
                    <box size="0.03 0.109 0.022"/>
                </geometry>
            </collision>
            <collision>
                <origin xyz="0.0 0.133 0.07" rpy="0 0 0"/>
                <geometry>
                    <box size="0.030 0.017 0.112"/>
                </geometry>
            </collision>
        </link>

        <link name="left_finger">
            <inertial>
                <origin xyz="0.0 -0.075 0.021" rpy="0 0 0"/>
                <mass value="0.284"/>
                <inertia ixx="7.653e-4" ixy="1.922e-5" ixz="-1.589e-5" iyy="3.805e-4" iyz="3.052e-4" izz="4.364e-4"/>
            </inertial>
            <visual>
                <geometry>
                    <mesh filename="package://rm_description/meshes/engineer/left_finger.stl"
                          scale="0.001 0.001 0.001"/>
                </geometry>
            </visual>
            <collision>
                <origin xyz="0.0 -0.043 0.005" rpy="0 0 0"/>
                <geometry>
                    <box size="0.030 0.027 0.063"/>
                </geometry>
            </collision>
            <collision>
                <origin xyz="0.0 -0.088 0.025" rpy="0 0 0"/>
                <geometry>
                    <box size="0.03 0.109 0.022"/>
                </geometry>
            </collision>
            <collision>
                <origin xyz="0.0 -0.129 0.07" rpy="0 0 0"/>
                <geometry>
                    <box size="0.030 0.017 0.112"/>
                </geometry>
            </collision>
        </link>

        <link name="camera">
            <inertial>
                <mass value="0.05"/>
                <origin xyz="0 0 0"/>
                <inertia ixx="1.271e-3" ixy="2.07e-7" ixz="8.854e-6" iyy="5.190e-4" iyz="1.001e-6" izz="9.976e-4"/>
            </inertial>
            <visual>
                <origin xyz=" 0 0 0 " rpy="0 0 0"/>
                <geometry>
                    <box size="0.022 0.021 0.0226"/>
                </geometry>
                <material name="Black"/>
            </visual>
            <collision>
                <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
                <geometry>
                    <box size="0.01 0.04 0.04"/>
                </geometry>
            </collision>
        </link>

        <joint name="camera_joint" type="fixed">
            <parent link="palm"/>
            <child link="camera"/>
            <origin xyz="0.055 -0.085 0.0962" rpy="0 0 0"/>
            <axis xyz="0 0 1"/>
        </joint>

        <xacro:unless value="${connected_to == ''}">
            <joint name="palm_joint" type="fixed">
                <parent link="${connected_to}"/>
                <child link="palm"/>
                <origin xyz="${xyz}" rpy="${rpy}"/>
            </joint>
        </xacro:unless>

        <joint name="right_finger_joint" type="prismatic">
            <parent link="palm"/>
            <child link="right_finger"/>
            <origin xyz="0 0 0.045" rpy="0 0 0"/>
            <axis xyz="0 1 0"/>
            <limit effort="588" lower="0.0" upper="0.03" velocity="3.772"/>
        </joint>

        <joint name="left_finger_joint" type="prismatic">
            <parent link="palm"/>
            <child link="left_finger"/>
            <origin xyz="0 0 0.045" rpy="0 0 0"/>
            <axis xyz="0 -1 0"/>
            <limit effort="588" lower="0.0" upper="0.03" velocity="3.772"/>
            <mimic joint="right_finger_joint"/>
        </joint>

        <xacro:if value="${simulation}">
            <gazebo>
                <plugin name="left_finger_mimic_joint_plugin"
                        filename="libroboticsgroup_upatras_gazebo_mimic_joint_plugin.so">
                    <joint>right_finger_joint</joint>
                    <mimicJoint>left_finger_joint</mimicJoint>
                    <hasPID/>
                    <maxEffort>588.0</maxEffort>
                </plugin>
            </gazebo>
            <gazebo reference="right_finger">
                <self_collide>1</self_collide>
                <mu1 value="2000000000.0"/>
                <mu2 value="2000000000.0"/>
                <kp value="1000000.0"/>
                <kd value="100.0"/>
                <material>Gazebo/Black</material>
            </gazebo>
            <gazebo reference="left_finger">
                <self_collide>1</self_collide>
                <mu1 value="2000000000.0"/>
                <mu2 value="2000000000.0"/>
                <kp value="1000000.0"/>
                <kd value="100.0"/>
                <material>Gazebo/Black</material>
            </gazebo>
        </xacro:if>

        <transmission name="trans_right_finger_joint">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="right_finger_joint">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
                <offset>0.0</offset>
            </joint>
            <actuator name="right_finger_motor">
                <mechanicalReduction>2356.194</mechanicalReduction>
            </actuator>
        </transmission>

    </xacro:macro>
</robot>
